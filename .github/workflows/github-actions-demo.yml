name: GitHub Actions Demo
on:
  push:

jobs:
  linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Check latest version
        if: github.event_name == 'push'
        run: |
          LLVM_VERSION=$(git ls-remote https://github.com/llvm/llvm-project.git | grep 'refs/heads/main$' | awk '{print $1}')
          echo LLVM_VERSION=$LLVM_VERSION >> $GITHUB_ENV
          MINGW_VERSION=$(git ls-remote https://github.com/mingw-w64/mingw-w64.git | grep 'refs/heads/master$' | awk '{print $1}')
          echo MINGW_VERSION=$MINGW_VERSION >> $GITHUB_ENV
          echo ASSERT_PARAMS=--enable-asserts >> $GITHUB_ENV
          echo Building llvm-project $LLVM_VERSION mingw-w64 $MINGW_VERSION
      - name: Build
        run: |
          sudo apt-get install ninja-build
          cd llvm-mingw
          ./build-all.sh $(pwd)/../install/llvm-mingw --disable-clang-tools-extra --disable-lldb $ASSERT_PARAMS
