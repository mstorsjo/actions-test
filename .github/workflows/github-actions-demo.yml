name: GitHub Actions Demo
on:
  push:
  schedule:
    - cron: '55 21 * * *'

jobs:
  get-versions:
    runs-on: ubuntu-latest
    steps:
      - name: Touch file
        run: |
          touch versions
      - name: Check latest version
        run: |
          echo LLVM_VERSION=$(git ls-remote https://github.com/llvm/llvm-project.git | grep 'refs/heads/main$' | awk '{print $1}') >> versions
          echo MINGW_W64_VERSION=$(git ls-remote https://github.com/mingw-w64/mingw-w64.git | grep 'refs/heads/master$' | awk '{print $1}') >> versions
          echo PYTHON_VERSION_MINGW=$(git ls-remote https://github.com/msys2-contrib/cpython-mingw.git | grep 'refs/heads/mingw-v3.9.11$' | awk '{print $1}') >> versions
      - uses: actions/upload-artifact@v2
        with:
          name: versions
          path: |
            versions
          retention-days: 7

  linux:
    needs: [get-versions]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v3
        with:
          name: versions
      - name: Check state 1
        run: |
          pwd
          ls
      - uses: actions/checkout@v2
        with:
          clean: false
      - name: Check state 2
        run: |
          pwd
          ls
