name: GitHub Actions Demo
on:
  push:
  schedule:
    - cron: '09 21 * * *'

jobs:
  linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Check latest version
        if: ${{ github.event_name == 'schedule' }}
        run: |
          echo LLVM_VERSION=$(git ls-remote https://github.com/llvm/llvm-project.git | grep 'refs/heads/main$' | awk '{print $1}') >> $GITHUB_ENV
          echo MINGW_VERSION=$(git ls-remote https://github.com/mingw-w64/mingw-w64.git | grep 'refs/heads/master$' | awk '{print $1}') >> $GITHUB_ENV
          echo ASSERT_PARAMS=--enable-asserts >> $GITHUB_ENV
      - name: Build
        run: |
          sudo apt-get install ninja-build
          cd llvm-mingw
          ./build-all.sh $(pwd)/../install/llvm-mingw --disable-clang-tools-extra --disable-lldb $ASSERT_PARAMS
