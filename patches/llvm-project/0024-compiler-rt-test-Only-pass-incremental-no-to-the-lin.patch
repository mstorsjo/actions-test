From 4f83e63e7842d8a5096816bf783da9e5a58929ae Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Martin=20Storsj=C3=B6?= <martin@martin.st>
Date: Wed, 5 Apr 2023 21:05:12 +0000
Subject: [PATCH 24/28] [compiler-rt] [test] Only pass -incremental:no to the
 linker for MSVC/clang-cl

---
 compiler-rt/test/profile/lit.cfg.py | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/compiler-rt/test/profile/lit.cfg.py b/compiler-rt/test/profile/lit.cfg.py
index de8840b770d8..9a96f472d40c 100644
--- a/compiler-rt/test/profile/lit.cfg.py
+++ b/compiler-rt/test/profile/lit.cfg.py
@@ -1,6 +1,7 @@
 # -*- Python -*-
 
 import os
+import re
 
 def get_required_attr(config, attr_name):
   attr_value = getattr(config, attr_name, None)
@@ -22,9 +23,11 @@ if hasattr(config, 'profile_lit_binary_dir') and \
         config.profile_lit_binary_dir is not None:
     config.test_exec_root = os.path.join(config.profile_lit_binary_dir, config.name)
 
+target_is_msvc = bool(re.match(r'.*-windows-msvc$', config.target_triple))
+
 if config.host_os in ['Linux']:
   extra_link_flags = ["-ldl"]
-elif config.host_os in ['Windows']:
+elif target_is_msvc:
   # InstrProf is incompatible with incremental linking. Disable it as a
   # workaround.
   extra_link_flags = ["-Wl,-incremental:no"]
-- 
2.34.1

